# Line Bot 功能測試指南

本指南將幫助您測試 Line Bot 的三個主要功能：熱門旅遊景點、旅遊規劃助手、美食推薦。

## 前置準備

### 1. 確認環境設定

確保以下項目已正確設定：

- ✅ 開發伺服器正在運行（`npm run dev`）
- ✅ Webhook URL 已設定並驗證成功
- ✅ 環境變數已正確設定（`.env` 檔案）
- ✅ 資料庫連接正常（MongoDB Atlas）
- ✅ OpenAI API Key 已設定
- ✅ 已在 Line Official Account Manager 中新增圖文選單（Rich Menu）

### 2. 確認圖文選單設定

在 Line App 中打開您的 Bot，應該能看到底部的圖文選單，包含三個按鈕：
- 📍 熱門景點
- 🗺️ 旅遊規劃
- 🍽️ 美食推薦

如果看不到圖文選單，請確認：
1. 已在 Line Official Account Manager 中設定 Rich Menu
2. Rich Menu 已設為預設選單
3. Line App 已更新到最新版本

## 功能測試

### 功能一：熱門旅遊景點

#### 測試步驟

1. **點擊「熱門景點」按鈕**
   - 預期回應：Bot 會詢問「您想查詢哪個地區的熱門景點呢？例如：台灣、日本、墾丁、花蓮等」

2. **指定地區測試**
   - 輸入：「墾丁」
   - 預期回應：Bot 會顯示墾丁地區的熱門景點列表（如果資料庫中有相關搜尋記錄）

3. **未指定地區測試**
   - 輸入：「都可以」或「隨便」
   - 預期回應：Bot 會顯示全台熱門景點列表

4. **多輪對話測試**
   - 點擊「熱門景點」按鈕
   - 當 Bot 詢問地區時，輸入：「我想看花蓮的景點」
   - 預期回應：Bot 會識別「花蓮」並顯示相關景點

#### 測試要點

- ✅ Bot 能正確引導使用者指定地區
- ✅ Bot 能從使用者回答中提取地區資訊
- ✅ Bot 能根據地區顯示對應的熱門景點
- ✅ 如果資料庫中沒有資料，會顯示預設的熱門景點列表

---

### 功能二：旅遊規劃助手

#### 測試步驟

1. **點擊「旅遊規劃」按鈕**
   - 預期回應：Bot 會發送歡迎訊息，說明需要收集的資訊（地點、預算、天數、人數、興趣類型、出發時間）

2. **逐步提供資訊測試**
   - 輸入：「我想去墾丁」
   - 預期回應：Bot 會記住地點，並詢問下一個缺少的資訊（例如：「您的預算是多少？」）

3. **繼續提供資訊**
   - 輸入：「預算五千塊」
   - 預期回應：Bot 會記住預算，並繼續詢問其他資訊（例如：「預計旅遊幾天？」）

4. **提供完整資訊測試**
   - 輸入：「我想去墾丁，預算五千塊，三天兩夜，兩個人，喜歡海邊活動」
   - 預期回應：Bot 會根據所有資訊提供詳細的旅遊規劃（包含景點、住宿、交通、餐飲建議）

5. **修改需求測試**
   - 在對話中輸入：「我想改成四天三夜」
   - 預期回應：Bot 會記住修改，並更新旅遊規劃

#### 測試要點

- ✅ Bot 能引導使用者逐步提供必要資訊
- ✅ Bot 能記住之前提供的資訊，不會重複詢問
- ✅ Bot 能根據完整資訊提供詳細的行程規劃
- ✅ Bot 能處理使用者修改需求的情況

---

### 功能三：美食推薦

#### 測試步驟

1. **點擊「美食推薦」按鈕**
   - 預期回應：Bot 會發送歡迎訊息，說明需要收集的資訊（地點、預算、飲食偏好、用餐人數、用餐時間）

2. **逐步提供資訊測試**
   - 輸入：「我想在台北找美食」
   - 預期回應：Bot 會記住地點，並詢問下一個缺少的資訊（例如：「您的預算範圍是？」）

3. **繼續提供資訊**
   - 輸入：「預算一個人五百塊左右」
   - 預期回應：Bot 會記住預算，並繼續詢問其他資訊（例如：「有什麼飲食偏好嗎？」）

4. **提供完整資訊測試**
   - 輸入：「我想在台北找美食，預算一個人五百塊，喜歡日式料理，兩個人，晚餐」
   - 預期回應：Bot 會根據所有資訊提供具體的美食推薦和餐廳建議（包含價格、特色、地址等）

5. **修改需求測試**
   - 在對話中輸入：「改成中式料理好了」
   - 預期回應：Bot 會記住修改，並更新美食推薦

#### 測試要點

- ✅ Bot 能引導使用者逐步提供必要資訊
- ✅ Bot 能記住之前提供的資訊，不會重複詢問
- ✅ Bot 能根據完整資訊提供具體的美食推薦
- ✅ Bot 能處理使用者修改需求的情況

---

## 功能模式切換測試

### 測試步驟

1. **切換功能模式**
   - 點擊「旅遊規劃」按鈕，開始旅遊規劃對話
   - 在對話過程中，點擊「美食推薦」按鈕
   - 預期行為：Bot 會切換到美食推薦模式，並發送美食推薦的歡迎訊息

2. **模式內對話**
   - 點擊「熱門景點」按鈕
   - 當 Bot 詢問地區時，輸入：「墾丁」
   - 預期行為：Bot 會繼續在熱門景點模式下處理訊息

3. **一般對話模式**
   - 不點擊任何功能按鈕，直接發送文字訊息
   - 輸入：「你好」
   - 預期行為：Bot 會使用一般的對話模式回應（不是功能模式）

#### 測試要點

- ✅ Bot 能正確切換功能模式
- ✅ Bot 能在功能模式下正確處理訊息
- ✅ Bot 能在一般模式下正常對話

---

## 錯誤處理測試

### 測試步驟

1. **網路錯誤測試**
   - 暫時斷開網路連接
   - 發送訊息給 Bot
   - 預期回應：Bot 會回覆友善的錯誤訊息，說明網路連接問題

2. **API 錯誤測試**
   - 如果 OpenAI API 配額用盡或發生錯誤
   - 預期回應：Bot 會回覆對應的錯誤訊息，並提供解決建議

3. **資料庫錯誤測試**
   - 如果 MongoDB 連接失敗
   - 預期回應：Bot 會回覆友善的錯誤訊息，說明資料庫服務問題

#### 測試要點

- ✅ Bot 能優雅地處理各種錯誤情況
- ✅ 錯誤訊息對使用者友善且清楚
- ✅ Bot 不會因為錯誤而崩潰

---

## 檢查日誌

在測試過程中，請注意查看終端視窗的日誌輸出：

### 正常日誌範例

```
收到 Postback 事件: popular_destinations
使用者 ID: U1234567890abcdef
✅ MongoDB 連接成功
收到訊息: 墾丁
使用者 ID: U1234567890abcdef
```

### 錯誤日誌範例

如果看到錯誤訊息，請檢查：
- 資料庫連接是否正常
- OpenAI API Key 是否正確
- 環境變數是否設定完整
- Webhook URL 是否正確

---

## 常見問題

### Q: 點擊 Rich Menu 按鈕沒有反應？

**A:** 請檢查：
1. Webhook URL 是否正確設定並驗證成功
2. 開發伺服器是否正在運行
3. 終端是否有錯誤訊息
4. Line App 是否已更新到最新版本

### Q: Bot 回應很慢？

**A:** 可能原因：
1. OpenAI API 回應時間較長（正常情況）
2. 網路連接較慢
3. 資料庫查詢時間較長

### Q: Bot 一直重複詢問同一個問題？

**A:** 可能原因：
1. 對話歷史沒有正確保存
2. LLM 沒有正確識別使用者提供的資訊
3. 資料庫連接有問題

解決方法：
- 檢查資料庫連接
- 查看終端日誌確認是否有錯誤
- 嘗試重新啟動開發伺服器

### Q: 熱門景點功能顯示的景點很少或沒有？

**A:** 這是正常情況，因為：
1. 如果資料庫中沒有相關的搜尋記錄，會顯示預設的熱門景點列表
2. 隨著使用者使用 Bot 搜尋景點，資料庫中的統計資料會逐漸累積

### Q: 如何清除對話歷史重新測試？

**A:** 可以：
1. 在 Admin 後台清除特定使用者的對話記錄
2. 或者等待對話自然過期（系統會保留最近的對話歷史）

---

## 測試檢查清單

使用以下檢查清單確保所有功能都正常運作：

### 熱門旅遊景點
- [ ] 點擊按鈕後能收到引導訊息
- [ ] 指定地區後能顯示對應景點
- [ ] 未指定地區時顯示全台景點
- [ ] 多輪對話能正確識別地區

### 旅遊規劃助手
- [ ] 點擊按鈕後能收到歡迎訊息
- [ ] 能引導使用者逐步提供資訊
- [ ] 能記住之前提供的資訊
- [ ] 能根據完整資訊提供行程規劃
- [ ] 能處理需求修改

### 美食推薦
- [ ] 點擊按鈕後能收到歡迎訊息
- [ ] 能引導使用者逐步提供資訊
- [ ] 能記住之前提供的資訊
- [ ] 能根據完整資訊提供美食推薦
- [ ] 能處理需求修改

### 功能模式切換
- [ ] 能在不同功能間切換
- [ ] 功能模式下能正確處理訊息
- [ ] 一般模式下能正常對話

### 錯誤處理
- [ ] 網路錯誤時能優雅處理
- [ ] API 錯誤時能提供友善訊息
- [ ] 資料庫錯誤時能正常降級

---

## 下一步

測試完成後，您可以：

1. **部署到 Vercel**
   - 將專案部署到生產環境
   - 更新 Webhook URL 為 Vercel 提供的 URL
   - 在 Vercel 環境變數中設定所有必要的環境變數

2. **優化功能**
   - 根據測試結果調整 LLM prompt
   - 優化熱門景點統計邏輯
   - 改進錯誤處理機制

3. **擴充功能**
   - 新增更多功能按鈕
   - 實作更複雜的對話流程
   - 整合更多外部 API

---

## 需要幫助？

如果測試過程中遇到問題，請：

1. 檢查終端日誌中的錯誤訊息
2. 確認所有環境變數已正確設定
3. 檢查資料庫和 API 連接狀態
4. 查看相關文檔（`SETUP.md`、`WEBHOOK_SETUP.md` 等）

祝測試順利！🎉

